{% extends "base.html"%}

{% block body %}

<form action="{% url 'create' %}" method="post">
    {% csrf_token %}
    
    <div class="row p-2">
        <div class="col-sm-6 ">
            <label> Subject: </label>
            <select class="form-control" id="subject" name='subject'>
                
                <option hidden disabled selected value> Subject </option>
                {% for subject in subjects %}
                    <option value="{{ subject.0 }}"> {{ subject.0 }}: {{ subject.1 }}</option>
                {% endfor %}
            </select>

            {% if form.subject.errors %}
            <div class="alert alert-danger">
                <h6 class="p-0">{{ form.subject.errors.as_text }}</h6>
            </div>
            {% endif %}
        </div>
        
        <div class="col-sm-6">
            <label> Course: </label>

            <select class="form-control" id="course" name="course" >
                <option hidden disabled selected value> Course </option>
            </select>

            {% if form.course.errors %}
            <div class="alert alert-danger">
                <h6 class="p-0">{{ form.course.errors.as_text }}</h6>
            </div>
            {% endif %}
        </div>
    </div>

    
    <div class="row p-2">
        <div class="col">
            <label> Description of what you need help with:</label>
            <textarea class="form-control" placeholder="The better specifications you give, the easier it will be for tutors to find you!" name="desc" id="desc" rows="3"></textarea>

            {% if form.desc.errors %}
            <div class="alert alert-danger">
                <h6 class="p-0">{{ form.desc.errors.as_text }}</h6>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="row p-2">
        <div class="col-sm-6">
            <label> Your contact information:</label>
            <input type='text' placeholder="Ex: 'instagram- bigdilf54 | email- bonehead@illinois.edu'" class="form-control" name="contact" id="contact" >

            {% if form.contact.errors %}
            <div class="alert alert-danger">
                <h6 class="p-0">{{ form.contact.errors.as_text }}</h6>
            </div>
            {% endif %}
        </div>

        <div class="col-sm">
            <label> School:</label>
            <select class="form-control" name="school" id="school" data-live-search="true">
                {% for school in schools %}
                    <option value="{{ school }}"> {{ school }}</option>
                {% endfor %}
            </select>
            
            {% if form.school.errors %}
            <div class="alert alert-danger">
                <h6 class="p-0">{{ form.school.errors.as_text }}</h6>
            </div>
            {% endif %}
        </div>

    </div>


    <div class="row p-2">
        <div class="col-sm-6">
            <label class="form-label">Extra attachments relating to the issue</label>
            <input class="form-control" type="file" id="fileupload" name='attach' multiple>
            
            {% if form.attach.errors %}
            <div class="alert alert-danger">
                <h6 class="p-0">{{ form.attach.errors.as_text }}</h6>
            </div>
            {% endif %}
        </div>
        
        <div class="col-sm-3">
            <label class="form-label"> Price offer</label>
            <input type='decimal' class="form-control" name="price" id="price" min="0" value="0" step="0.1" placeholder="Price you think is right ammount to pay the tutor">
            {% if form.price.errors %}
            <div class="alert alert-danger">
                <h6 class="p-0">{{ form.price.errors.as_text }}</h6>
            </div>
            {% endif %}
        </div>

        <div class="col-sm-3">
            <label class="form-label"> Per Hour Rate</label>
            <input type='decimal' class="form-control" name="PH" id="PH" min="0" value="0" step="0.1" placeholder="Per hour rate">
            {% if form.PH.errors %}
            <div class="alert alert-danger">
                <h6 class="p-0">{{ form.PH.errors.as_text }}</h6>
            </div>
            {% endif %}
        </div>

    </div>

    
    <div class="row p-2">
        <div class="col-sm-6">
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </div>
    </div>

</form>

<script type="text/javascript">
 
    {% if form %}
        {% for field in form %}
        if("{{ field.value }}" != ""){
            $("#{{field.html_name}}").val("{{ field.value }}");
        }
        {% endfor %} 

        let url = "/jquery/" + $("#subject").val() + "/";
        $.get(url, function(data, status){
            let subjects = data['subject']

            var $el = $("#course");
            $el.empty(); 
            $.each(subjects, function(key,value) {
                $el.append($("<option></option>").attr("value", value).text(value));
            });
        });
    
    {% endif %}

    $('#subject').change(function(){
        let url = "/jquery/" + $("#subject").val() + "/";
        $.get(url, function(data, status){
            let subjects = data['subject']

            var $el = $("#course");
            $el.empty(); 
            $.each(subjects, function(key,value) {
                $el.append($("<option></option>").attr("value", value).text(value));
            });
        });
    });

</script>

{% endblock %}